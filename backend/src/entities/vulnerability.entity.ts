import { Entity, PrimaryKey, Property, ManyToOne, Enum } from '@mikro-orm/core';
import { Scan } from './scan.entity';

export enum VulnerabilitySeverity {
  CRITICAL = 'critical',
  HIGH = 'high',
  MEDIUM = 'medium',
  LOW = 'low',
  INFO = 'info',
}

export enum VulnerabilityCategory {
  OWASP_TOP10 = 'owasp_top10',
  DEPENDENCY = 'dependency',
  SECRET = 'secret',
  SSL_TLS = 'ssl_tls',
  SECURITY_HEADERS = 'security_headers',
  INFRASTRUCTURE = 'infrastructure',
  CODE_QUALITY = 'code_quality',
}

@Entity()
export class Vulnerability {
  @PrimaryKey()
  id!: number;

  @ManyToOne(() => Scan)
  scan!: Scan;

  @Property()
  title!: string;

  @Property({ type: 'text' })
  description!: string;

  @Enum(() => VulnerabilitySeverity)
  severity!: VulnerabilitySeverity;

  @Enum(() => VulnerabilityCategory)
  category!: VulnerabilityCategory;

  @Property({ nullable: true })
  cveId?: string;

  @Property({ nullable: true })
  cweId?: string;

  @Property({ type: 'text', nullable: true })
  aiExplanation?: string;

  @Property({ type: 'text', nullable: true })
  fixGuide?: string;

  @Property({ type: 'json', nullable: true })
  metadata?: any;

  @Property()
  createdAt: Date = new Date();
}
